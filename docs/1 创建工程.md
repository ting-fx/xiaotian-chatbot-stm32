# 创建工程

本节介绍如何基于 STM32CubeMX + STM32CubeIDE 创建一个基于 STM32F779I-EVAL 开发板的工程，并对生成的工程结构进行说明。

## 使用 STM32CubeMX 创建工程

### 从 ST Board 创建工程
打开 STM32CubeMX，选择 From Board 方式创建工程。

![alt text](<imgs/1 创建工程-1.png>)

### 选择开发板型号
在搜索框中输入开发板型号，在结果列表中选择对应的板子，然后点击 Start Project。

![alt text](<imgs/1 创建工程-2.png>)

### 初始化板级外设
在弹出的提示窗口中选择 Yes，表示按照开发板原理图自动初始化所有板载外设。

![alt text](<imgs/1 创建工程-3.png>)

### 配置工程信息并生成代码
- 设置工程名称
- 选择工程保存路径
- 选择开发 IDE（这里选择 STM32CubeIDE）
- 配置完成后，点击 Generate Code 生成工程代码。

![alt text](<imgs/1 创建工程-4.png>)

## 在 STM32CubeIDE 中导入工程
### 创建 Workspace
打开 STM32CubeIDE，创建一个新的 workspace。

![alt text](<imgs/1 创建工程-5-创建workspace.png>)

### 导入已有工程
- 在 STM32CubeIDE 中点击左上角菜单：File → Import
- 在弹出的窗口中选择 Existing Projects into Workspace。

![alt text](<imgs/1 创建工程-6-import.png>)

### 选择工程路径并导入
选择刚才在 CubeMX 中生成的工程路径，在工程列表中勾选该工程，点击 Finish，完成导入。

![alt text](<imgs/1 创建工程-7-import.png>)

### 工程导入完成
成功导入后，可以在 Project Explorer 中看到生成的工程目录结构。

![alt text](<imgs/1 创建工程-8-目录结构.png>)

## 工程目录结构分析

### Inc（头文件目录）
```text
Inc/
 ├─ main.h
 ├─ stm32f7xx_hal_conf.h
 └─ stm32f7xx_it.h
```

- main.h: 主程序头文件，包含全局宏和函数声明
- stm32f7xx_hal_conf.h: HAL 库配置文件，用于启用或裁剪外设驱动
- stm32f7xx_it.h: 中断服务函数声明

### Src（源文件目录）

```text
Src/
 ├─ main.c
 ├─ stm32f7xx_hal_msp.c
 ├─ stm32f7xx_it.c
 ├─ syscalls.c
 ├─ sysmem.c
 └─ system_stm32f7xx.c
```

- main.c: 应用程序入口，包含 main() 函数
- stm32f7xx_hal_msp.c: HAL 底层初始化（GPIO、DMA、时钟等）
- stm32f7xx_it.c: 中断服务函数实现
- syscalls.c/sysmem.c: C标准库的底层适配层，用于支持 malloc / printf 等 C 库函数
- system_stm32f7xx.c: 系统时钟配置（PLL、AHB、APB）

### Startup（启动文件）
```text
Startup/
 └─ startup_stm32f779nihx.s
```
- 芯片上电后执行的第一段代码（汇编）
- 主要功能：
    - 设置初始堆栈指针（SP）
    - 设置初始程序计数器（PC），即 Reset_Handler
    - 初始化中断向量表，将各异常/中断的 ISR 地址写入向量表
    - 跳转到 C 运行库中的入口函数（该函数最终会调用 main()）

### Drivers（驱动库）
 
- CMSIS (Cortex Microcontroller Software Interface Standard): ARM 官方定义的CPU抽象层，不同厂商的内核用同一套接口
- HAL_Driver(Hardware Abstraction Layer): 外设驱动库，基于CMSIS

### 链接脚本（Linker Script）
```text
STM32F779NIHX_FLASH.ld
STM32F779NIHX_RAM.ld
```
- 告诉编译器程序、变量在Flash/RAM的什么位置
- 提供两种运行方式：
    - FLASH.ld：程序从 Flash 启动（常用、量产）
    - RAM.ld：程序从 RAM 启动（调试或特殊场景）
当前工程使用的是 STM32F779NIHX_FLASH.ld

## 小结

- CubeMX：负责生成硬件配置代码
- CubeIDE：负责编译、下载和调试
- CMSIS：CPU 抽象层
- HAL Driver：外设驱动层
- Startup + ld 文件：决定程序如何启动、如何使用内存
